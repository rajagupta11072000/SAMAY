<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMAY PRO | Ultimate Vedic Chronometer</title>
    <!-- Astronomy Engine for High-Precision Vedic Math -->
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
    <!-- Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #040404;
            --bg-panel: #141414;
            --accent: #00f3ff; /* Cyber Blue */
            --gold: #ffb700;   /* Vedic Gold */
            --danger: #ff3b3b;
            --text-main: #ffffff;
            --text-dim: #888888;
            --font-display: 'Segoe UI', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: var(--font-display);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- LAYOUT --- */
        .app-container {
            display: flex;
            flex: 1;
            height: 100%;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Sidebar (Desktop) / Bottom Bar (Mobile) */
        .nav-bar {
            background: var(--bg-panel);
            border-right: 1px solid #222;
            width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            gap: 20px;
            z-index: 100;
        }

        .nav-item {
            width: 50px; height: 50px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            color: var(--text-dim);
            transition: 0.3s;
            flex-direction: column;
            font-size: 10px;
            gap: 4px;
        }
        .nav-item span.material-icons-round { font-size: 24px; }
        .nav-item:hover { background: #222; color: #fff; }
        .nav-item.active { background: rgba(0, 243, 255, 0.1); color: var(--accent); }
        .nav-item.active span { text-shadow: 0 0 10px var(--accent); }

        /* Main Content Area */
        .content-stage {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .view-section {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            padding: 30px;
            overflow-y: auto;
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
            transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .view-section.active {
            opacity: 1;
            pointer-events: all;
            transform: translateY(0);
        }

        h1 { font-size: 2rem; margin-bottom: 20px; font-weight: 300; letter-spacing: 2px; color: var(--text-dim); }
        h1 b { color: #fff; font-weight: 700; }

        /* --- COMPONENT: CLOCK (HOME) --- */
        .clock-stage {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100%; gap: 40px;
        }

        /* Analog Clock SVG */
        .analog-clock {
            width: 300px; height: 300px;
            position: relative;
        }
        .analog-face {
            fill: none; stroke: var(--accent); stroke-width: 2;
            filter: drop-shadow(0 0 10px rgba(0,243,255,0.3));
        }
        .hand { stroke-linecap: round; transform-origin: 50% 50%; transition: transform 0.1s cubic-bezier(0.4, 2.08, 0.55, 0.44); }
        .hour-hand { stroke: #fff; stroke-width: 4; }
        .min-hand { stroke: #fff; stroke-width: 2; }
        .sec-hand { stroke: var(--danger); stroke-width: 1; transition: none; }
        .clock-center { fill: var(--accent); }

        .digital-time { font-size: 5rem; font-weight: 700; font-variant-numeric: tabular-nums; letter-spacing: -2px; }
        .digital-date { font-size: 1.2rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 4px; }

        /* --- COMPONENT: PANCHANG GRID --- */
        .vedic-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;
        }
        .v-card {
            background: #1a1a1a; border: 1px solid #333; padding: 20px; border-radius: 16px;
            position: relative; overflow: hidden;
        }
        .v-card::before { content:''; position:absolute; top:0; left:0; width:4px; height:100%; background: var(--gold); }
        .v-label { color: var(--text-dim); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .v-value { font-size: 1.4rem; color: #fff; font-weight: 600; }
        .v-sub { font-size: 0.9rem; color: var(--gold); margin-top: 5px; }

        /* --- COMPONENT: WORLD CLOCK --- */
        .city-search { 
            width: 100%; padding: 15px; background: #111; border: 1px solid #333; 
            color: #fff; border-radius: 12px; margin-bottom: 20px; font-size: 1rem;
        }
        .world-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .city-card {
            display: flex; justify-content: space-between; align-items: center;
            background: #1a1a1a; padding: 20px; border-radius: 12px; border-bottom: 2px solid #333;
        }
        .city-info h3 { font-size: 1.1rem; font-weight: 600; }
        .city-info p { font-size: 0.8rem; color: var(--text-dim); margin-top: 4px; }
        .city-clock { font-size: 1.5rem; font-family: monospace; color: var(--accent); }

        /* --- COMPONENT: ALARMS --- */
        .alarm-controls { display: flex; gap: 10px; margin-bottom: 20px; background: #111; padding: 15px; border-radius: 12px; }
        .alarm-list { display: flex; flex-direction: column; gap: 10px; }
        .alarm-item {
            background: #1e1e1e; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;
        }
        .alarm-time { font-size: 1.5rem; font-weight: bold; }
        .switch {
            position: relative; display: inline-block; width: 40px; height: 20px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            .nav-bar { 
                width: 100%; height: 70px; flex-direction: row; 
                order: 2; border-right: none; border-top: 1px solid #333; 
                padding: 0; justify-content: space-around;
            }
            .content-stage { order: 1; }
            .digital-time { font-size: 3.5rem; }
            .analog-clock { width: 220px; height: 220px; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <!-- NAVIGATION -->
    <nav class="nav-bar">
        <div class="nav-item active" onclick="nav('home', this)">
            <span class="material-icons-round">schedule</span>
            <span>Clock</span>
        </div>
        <div class="nav-item" onclick="nav('world', this)">
            <span class="material-icons-round">public</span>
            <span>World</span>
        </div>
        <div class="nav-item" onclick="nav('vedic', this)">
            <span class="material-icons-round">self_improvement</span>
            <span>Vedic</span>
        </div>
        <div class="nav-item" onclick="nav('tools', this)">
            <span class="material-icons-round">alarm</span>
            <span>Alarms</span>
        </div>
    </nav>

    <!-- CONTENT -->
    <main class="content-stage">
        
        <!-- 1. HOME (Clock) -->
        <div id="view-home" class="view-section active">
            <div class="clock-stage">
                <div style="position: relative;">
                    <!-- SVG Analog Clock -->
                    <svg class="analog-clock" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="48" class="analog-face" />
                        <!-- Markers -->
                        <path d="M50 2 V5" stroke="#444" stroke-width="2" />
                        <path d="M50 95 V98" stroke="#444" stroke-width="2" />
                        <path d="M2 50 H5" stroke="#444" stroke-width="2" />
                        <path d="M95 50 H98" stroke="#444" stroke-width="2" />
                        
                        <!-- Hands -->
                        <line x1="50" y1="50" x2="50" y2="25" class="hand hour-hand" id="h-hand" />
                        <line x1="50" y1="50" x2="50" y2="10" class="hand min-hand" id="m-hand" />
                        <line x1="50" y1="50" x2="50" y2="10" class="hand sec-hand" id="s-hand" />
                        <circle cx="50" cy="50" r="3" class="clock-center" />
                    </svg>
                </div>
                <div style="text-align: center;">
                    <div class="digital-time" id="main-digi">00:00:00</div>
                    <div class="digital-date" id="main-date">Loading Date...</div>
                    <div id="next-alarm-disp" style="color: var(--accent); margin-top: 10px; font-size: 0.9rem;"></div>
                </div>
            </div>
        </div>

        <!-- 2. WORLD CLOCK -->
        <div id="view-world" class="view-section">
            <h1>World <b>Clock</b></h1>
            <input type="text" class="city-search" placeholder="Search City (e.g. London, Tokyo)..." onkeyup="filterCities(this.value)">
            <div class="world-list" id="world-grid"></div>
        </div>

        <!-- 3. VEDIC PANCHANG -->
        <div id="view-vedic" class="view-section">
            <h1>Vedic <b>Panchang</b></h1>
            <div class="vedic-grid">
                <div class="v-card">
                    <div class="v-label">Tithi (Lunar Day)</div>
                    <div class="v-value" id="p-tithi">--</div>
                    <div class="v-sub" id="p-paksha">--</div>
                </div>
                <div class="v-card">
                    <div class="v-label">Nakshatra (Star)</div>
                    <div class="v-value" id="p-nak">--</div>
                </div>
                <div class="v-card">
                    <div class="v-label">Yoga (Sum)</div>
                    <div class="v-value" id="p-yoga">--</div>
                </div>
                <div class="v-card">
                    <div class="v-label">Karan (Half-Tithi)</div>
                    <div class="v-value" id="p-karan">--</div>
                </div>
                <div class="v-card" style="border-color: var(--gold);">
                    <div class="v-label">Sun Status</div>
                    <div class="v-sub">Rise: <span id="p-rise" style="color:#fff">--</span></div>
                    <div class="v-sub">Set: <span id="p-set" style="color:#fff">--</span></div>
                </div>
                <div class="v-card" style="border-color: var(--danger);">
                    <div class="v-label">Rahukaal (Today)</div>
                    <div class="v-value" id="p-rahu" style="color:var(--danger)">--</div>
                    <div class="v-sub">Avoid auspicious work</div>
                </div>
            </div>
            <div style="margin-top: 20px; color: #666; font-size: 0.8rem; text-align: center;">
                *Calculations based on your local coordinates via Astronomy Engine.
            </div>
        </div>

        <!-- 4. TOOLS (ALARMS) -->
        <div id="view-tools" class="view-section">
            <h1>Alarm <b>Manager</b></h1>
            <div class="alarm-controls">
                <input type="time" id="new-alarm-time" style="background:#333; border:none; color:#fff; padding:10px; border-radius:5px; font-size:1.2rem;">
                <input type="text" id="new-alarm-label" placeholder="Label (e.g. Meeting)" style="background:#333; border:none; color:#fff; padding:10px; border-radius:5px; flex:1;">
                <button onclick="addAlarm()" style="background:var(--accent); border:none; padding:0 20px; border-radius:5px; font-weight:bold; cursor:pointer;">ADD</button>
            </div>
            <div class="alarm-list" id="alarm-list-container">
                <!-- Alarms injected here -->
            </div>
        </div>

    </main>
</div>

<script>
    /* --- STATE & CONFIG --- */
    let alarms = JSON.parse(localStorage.getItem('samay_alarms')) || [];
    const majorCities = [
        {name: 'New York', tz: 'America/New_York', country: 'USA'},
        {name: 'London', tz: 'Europe/London', country: 'UK'},
        {name: 'Dubai', tz: 'Asia/Dubai', country: 'UAE'},
        {name: 'Tokyo', tz: 'Asia/Tokyo', country: 'Japan'},
        {name: 'Sydney', tz: 'Australia/Sydney', country: 'Australia'},
        {name: 'Singapore', tz: 'Asia/Singapore', country: 'Singapore'},
        {name: 'Paris', tz: 'Europe/Paris', country: 'France'},
        {name: 'Berlin', tz: 'Europe/Berlin', country: 'Germany'},
        {name: 'Moscow', tz: 'Europe/Moscow', country: 'Russia'},
        {name: 'Los Angeles', tz: 'America/Los_Angeles', country: 'USA'},
        {name: 'Chicago', tz: 'America/Chicago', country: 'USA'},
        {name: 'Toronto', tz: 'America/Toronto', country: 'Canada'},
        {name: 'Hong Kong', tz: 'Asia/Hong_Kong', country: 'China'},
        {name: 'Mumbai', tz: 'Asia/Kolkata', country: 'India'},
        {name: 'Shanghai', tz: 'Asia/Shanghai', country: 'China'},
        {name: 'Sao Paulo', tz: 'America/Sao_Paulo', country: 'Brazil'},
        {name: 'Johannesburg', tz: 'Africa/Johannesburg', country: 'South Africa'}
    ];

    /* --- 1. CORE CLOCK ENGINE --- */
    function tick() {
        const now = new Date();
        
        // Digital
        document.getElementById('main-digi').innerText = now.toLocaleTimeString('en-US', {hour12: false});
        document.getElementById('main-date').innerText = now.toLocaleDateString('en-US', {weekday: 'long', month: 'long', day: 'numeric'});

        // Analog Math
        const sec = now.getSeconds();
        const min = now.getMinutes();
        const hr = now.getHours();
        
        const sDeg = sec * 6;
        const mDeg = (min * 6) + (sec * 0.1);
        const hDeg = ((hr % 12) * 30) + (min * 0.5);

        document.getElementById('s-hand').setAttribute('transform', `rotate(${sDeg}, 50, 50)`);
        document.getElementById('m-hand').setAttribute('transform', `rotate(${mDeg}, 50, 50)`);
        document.getElementById('h-hand').setAttribute('transform', `rotate(${hDeg}, 50, 50)`);

        // Check Alarms
        checkAlarms(now);
    }
    setInterval(tick, 1000);

    /* --- 2. WORLD CLOCK --- */
    function renderCities(filterText = '') {
        const grid = document.getElementById('world-grid');
        grid.innerHTML = '';
        
        const now = new Date();
        const filtered = majorCities.filter(c => c.name.toLowerCase().includes(filterText.toLowerCase()));

        filtered.forEach(city => {
            const time = now.toLocaleTimeString('en-US', {timeZone: city.tz, hour: '2-digit', minute:'2-digit'});
            const diff = -(now.getTimezoneOffset()) - (new Date().toLocaleString('en-US', {timeZone: city.tz, timeZoneName: 'short'}).includes('GMT') ? 0 : 0); // simplified diff logic for demo
            
            grid.innerHTML += `
                <div class="city-card">
                    <div class="city-info">
                        <h3>${city.name}</h3>
                        <p>${city.country}</p>
                    </div>
                    <div class="city-clock">${time}</div>
                </div>
            `;
        });
    }
    filterCities = renderCities; // Bind search

    /* --- 3. VEDIC ENGINE (Advanced) --- */
    function updatePanchang() {
        const now = new Date();
        // Get Sun/Moon coords
        const sun = Astronomy.EclipticLongitude('Sun', now);
        const moon = Astronomy.EclipticLongitude('Moon', now);
        const ayanamsa = 24.1; // Approx Lahiri

        // Sidereal Conversion
        const sSun = (sun - ayanamsa + 360) % 360;
        const sMoon = (moon - ayanamsa + 360) % 360;

        // A. TITHI
        const elongation = (sMoon - sSun + 360) % 360;
        const tithiIdx = Math.ceil(elongation / 12);
        document.getElementById('p-tithi').innerText = getTithiName(tithiIdx);
        document.getElementById('p-paksha').innerText = tithiIdx <= 15 ? "Shukla Paksha" : "Krishna Paksha";

        // B. NAKSHATRA
        const nakIdx = Math.floor(sMoon / 13.3333);
        const naks = ["Ashwini","Bharani","Krittika","Rohini","Mrigashirsha","Ardra","Punarvasu","Pushya","Ashlesha","Magha","Purva P.","Uttara P.","Hasta","Chitra","Swati","Vishakha","Anuradha","Jyeshtha","Mula","Purva A.","Uttara A.","Shravana","Dhanishtha","Shatabhisha","Purva B.","Uttara B.","Revati"];
        document.getElementById('p-nak').innerText = naks[nakIdx];

        // C. YOGA (Sun+Moon)
        const yogaSum = (sSun + sMoon) % 360;
        const yogaIdx = Math.floor(yogaSum / 13.3333);
        const yogas = ["Vishkumbha","Priti","Ayushman","Saubhagya","Sobhana","Atiganda","Sukarma","Dhriti","Shula","Ganda","Vriddhi","Dhruva","Vyaghata","Harshana","Vajra","Siddhi","Vyatipata","Variyan","Parigha","Shiva","Siddha","Sadhya","Shubha","Shukla","Brahma","Indra","Vaidhriti"];
        document.getElementById('p-yoga').innerText = yogas[yogaIdx];

        // D. KARAN (Half Tithi)
        // Logic: 1 Tithi has 2 Karans. Total 60 Karan slots in a month.
        const karanAbsIdx = Math.ceil(elongation / 6);
        document.getElementById('p-karan').innerText = getKaranName(karanAbsIdx);

        // E. RAHUKAAL (Fixed approx for demo)
        const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        const rahuTimes = ["16:30-18:00", "07:30-09:00", "15:00-16:30", "12:00-13:30", "13:30-15:00", "10:30-12:00", "09:00-10:30"];
        document.getElementById('p-rahu').innerText = rahuTimes[now.getDay()] + " (Approx)";
        
        // F. SUNRISE/SET
        navigator.geolocation.getCurrentPosition(pos => {
            const observer = new Astronomy.Observer(pos.coords.latitude, pos.coords.longitude, 0);
            const rise = Astronomy.SearchRiseSet('Sun', observer, +1, now, 300);
            const set = Astronomy.SearchRiseSet('Sun', observer, -1, now, 300);
            if(rise) document.getElementById('p-rise').innerText = rise.date.toLocaleTimeString();
            if(set) document.getElementById('p-set').innerText = set.date.toLocaleTimeString();
        });
    }

    function getTithiName(i) {
        const names = ["Purnima/Amavasya","Pratipada","Dwitiya","Tritiya","Chaturthi","Panchami","Shashthi","Saptami","Ashtami","Navami","Dashami","Ekadashi","Dwadashi","Trayodashi","Chaturdashi","Purnima","Pratipada","Dwitiya","Tritiya","Chaturthi","Panchami","Shashthi","Saptami","Ashtami","Navami","Dashami","Ekadashi","Dwadashi","Trayodashi","Chaturdashi","Amavasya"];
        return names[i];
    }

    function getKaranName(k) {
        // k is 1 to 60
        if(k===1) return "Kimstughna";
        if(k>=58) return ["Shakuni","Chatushpad","Naga"][k-58];
        // Cycle of 7: Bava, Balava, Kaulava, Taitila, Gara, Vanija, Vishti
        const movable = ["Bava","Balava","Kaulava","Taitila","Gara","Vanija","Vishti"];
        return movable[(k-2) % 7];
    }

    /* --- 4. ALARM SYSTEM --- */
    function renderAlarms() {
        const list = document.getElementById('alarm-list-container');
        list.innerHTML = '';
        alarms.forEach((a, index) => {
            list.innerHTML += `
                <div class="alarm-item">
                    <div>
                        <div class="alarm-time">${a.time}</div>
                        <div style="color:#888; font-size:0.8rem">${a.label}</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" ${a.active ? 'checked' : ''} onchange="toggleAlarm(${index})">
                        <span class="slider"></span>
                    </label>
                    <button onclick="deleteAlarm(${index})" style="background:none; border:none; color:#666; margin-left:10px; cursor:pointer;">âœ•</button>
                </div>
            `;
        });
        localStorage.setItem('samay_alarms', JSON.stringify(alarms));
        updateNextAlarmDisp();
    }

    function addAlarm() {
        const time = document.getElementById('new-alarm-time').value;
        const label = document.getElementById('new-alarm-label').value || 'Alarm';
        if(!time) return;
        alarms.push({ time, label, active: true });
        renderAlarms();
    }

    function deleteAlarm(i) {
        alarms.splice(i, 1);
        renderAlarms();
    }

    function toggleAlarm(i) {
        alarms[i].active = !alarms[i].active;
        renderAlarms();
    }

    function checkAlarms(now) {
        const currentStr = now.toTimeString().slice(0,5);
        const sec = now.getSeconds();
        if (sec !== 0) return; // Check only at start of minute

        alarms.forEach(a => {
            if(a.active && a.time === currentStr) {
                alert(`â° ALARM: ${a.label}`);
                // Optional: Play sound here
            }
        });
    }
    
    function updateNextAlarmDisp() {
        const active = alarms.filter(a => a.active).sort((a,b) => a.time.localeCompare(b.time));
        const disp = document.getElementById('next-alarm-disp');
        if(active.length > 0) disp.innerText = `ðŸ”” Next: ${active[0].time} (${active[0].label})`;
        else disp.innerText = '';
    }

    /* --- UTILS --- */
    function nav(viewId, btn) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-'+viewId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }

    // Init
    renderCities();
    renderAlarms();
    updatePanchang();
    setInterval(updatePanchang, 60000); // Update Vedic calc every min
</script>
</body>
</html>
