<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMAY ULTIMATE | AI Chronometer</title>
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root {
            --bg: #09090b; --surface: #18181b; --surface-2: #27272a;
            --primary: #06b6d4; --gold: #eab308; --danger: #f43f5e;
            --text: #e4e4e7; --text-dim: #a1a1aa;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; }
        
        /* SIDEBAR NAV */
        .sidebar { width: 80px; background: var(--surface); display: flex; flex-direction: column; align-items: center; padding-top: 20px; border-right: 1px solid var(--surface-2); z-index: 10; }
        .nav-btn { width: 50px; height: 50px; margin-bottom: 15px; border-radius: 12px; border: none; background: transparent; color: var(--text-dim); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; font-size: 0.6rem; transition: 0.2s; }
        .nav-btn span { font-size: 24px; }
        .nav-btn:hover { background: var(--surface-2); color: #fff; }
        .nav-btn.active { background: rgba(6, 182, 212, 0.15); color: var(--primary); }

        /* MAIN AREA */
        .main { flex: 1; position: relative; overflow: hidden; }
        .view { position: absolute; inset: 0; padding: 30px; overflow-y: auto; opacity: 0; transform: translateY(20px); pointer-events: none; transition: 0.3s; }
        .view.active { opacity: 1; transform: translateY(0); pointer-events: all; }
        
        h1 { font-size: 1.8rem; margin-bottom: 20px; color: #fff; display: flex; align-items: center; gap: 10px; }
        h1 span { color: var(--primary); }

        /* CLOCK FACE */
        .clock-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 90%; gap: 30px; }
        .analog-wrapper { position: relative; width: 280px; height: 280px; border-radius: 50%; background: var(--surface); border: 4px solid var(--surface-2); box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom center; border-radius: 4px; transition: transform 0.1s cubic-bezier(0.4, 2.3, 0.3, 1); }
        .h-hand { width: 6px; height: 70px; background: #fff; margin-left: -3px; }
        .m-hand { width: 4px; height: 100px; background: var(--text-dim); margin-left: -2px; }
        .s-hand { width: 2px; height: 110px; background: var(--danger); margin-left: -1px; transition: none; }
        .center-dot { position: absolute; top: 50%; left: 50%; width: 12px; height: 12px; background: var(--primary); transform: translate(-50%, -50%); border-radius: 50%; }
        .digital-wrap { text-align: center; }
        .d-time { font-size: 4rem; font-weight: 700; font-variant-numeric: tabular-nums; letter-spacing: -2px; color: #fff; }
        .d-date { font-size: 1.2rem; color: var(--text-dim); margin-top: -10px; }

        /* CARDS & GRIDS */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; }
        .card { background: var(--surface); padding: 20px; border-radius: 16px; border: 1px solid var(--surface-2); }
        .card-title { font-size: 0.8rem; text-transform: uppercase; color: var(--text-dim); letter-spacing: 1px; margin-bottom: 8px; }
        .card-val { font-size: 1.5rem; font-weight: 600; color: #fff; }
        .highlight { color: var(--gold); }

        /* WORLD CLOCK */
        .search-bar { width: 100%; padding: 15px; background: var(--surface); border: 1px solid var(--surface-2); color: #fff; border-radius: 10px; margin-bottom: 20px; font-size: 1rem; }
        .city-row { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid var(--surface-2); align-items: center; }
        .city-time { font-family: monospace; font-size: 1.2rem; color: var(--primary); }

        /* TOOLS */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-pill { padding: 8px 20px; background: var(--surface); border-radius: 20px; cursor: pointer; border: 1px solid var(--surface-2); color: var(--text-dim); }
        .tab-pill.active { background: var(--primary); color: #000; font-weight: bold; border: none; }
        .tool-panel { display: none; } .tool-panel.active { display: block; }
        .big-timer { font-size: 5rem; text-align: center; font-family: monospace; margin: 40px 0; }
        .btn-group { display: flex; justify-content: center; gap: 15px; }
        .btn { width: 60px; height: 60px; border-radius: 50%; border: none; font-weight: bold; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-start { background: var(--primary); color: #000; } .btn-stop { background: var(--danger); color: #fff; } .btn-reset { background: var(--surface-2); color: #fff; }
        
        /* ALARMS */
        .alarm-list { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .alarm-item { background: var(--surface); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
        .alarm-item.ringing { border: 2px solid var(--danger); animation: shake 0.5s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(1px, 1px); } }

        @media (max-width: 600px) {
            body { flex-direction: column; }
            .sidebar { width: 100%; height: 70px; flex-direction: row; justify-content: space-evenly; padding: 0; border-right: none; border-top: 1px solid var(--surface-2); order: 2; }
            .nav-btn { height: 100%; width: auto; margin: 0; padding: 0 10px; }
            .main { order: 1; }
        }
    </style>
</head>
<body>

<!-- NAV -->
<nav class="sidebar">
    <button class="nav-btn active" onclick="show('clock', this)"><span class="material-icons-round">schedule</span>Clock</button>
    <button class="nav-btn" onclick="show('world', this)"><span class="material-icons-round">public</span>World</button>
    <button class="nav-btn" onclick="show('vedic', this)"><span class="material-icons-round">spa</span>Vedic</button>
    <button class="nav-btn" onclick="show('tools', this)"><span class="material-icons-round">timer</span>Tools</button>
</nav>

<!-- MAIN CONTENT -->
<main class="main">
    
    <!-- 1. CLOCK TAB -->
    <div id="view-clock" class="view active">
        <div class="clock-container">
            <div class="analog-wrapper">
                <div class="hand h-hand" id="h-hand"></div>
                <div class="hand m-hand" id="m-hand"></div>
                <div class="hand s-hand" id="s-hand"></div>
                <div class="center-dot"></div>
                <!-- Markers generated by JS -->
                <div id="dial-markers"></div>
            </div>
            <div class="digital-wrap">
                <div class="d-time" id="digi-time">00:00:00</div>
                <div class="d-date" id="digi-date">Loading...</div>
            </div>
        </div>
    </div>

    <!-- 2. WORLD TAB -->
    <div id="view-world" class="view">
        <h1>World <span>Clock</span></h1>
        <input type="text" class="search-bar" placeholder="Search 50+ Cities..." onkeyup="filterCities(this.value)">
        <div id="city-grid" class="grid"></div>
    </div>

    <!-- 3. VEDIC TAB -->
    <div id="view-vedic" class="view">
        <h1>Vedic <span>Panchang</span></h1>
        <div class="grid">
            <div class="card">
                <div class="card-title">Tithi (Lunar Day)</div>
                <div class="card-val" id="p-tithi">--</div>
                <div style="color: var(--gold)" id="p-paksha">--</div>
            </div>
            <div class="card">
                <div class="card-title">Nakshatra</div>
                <div class="card-val" id="p-nak">--</div>
            </div>
            <div class="card">
                <div class="card-title">Abhijit Muhurat</div>
                <div class="card-val highlight">11:45 - 12:30</div>
                <div class="card-title">Best time for work</div>
            </div>
            <div class="card">
                <div class="card-title">Rahukaal (Avoid)</div>
                <div class="card-val" style="color: var(--danger)" id="p-rahu">--</div>
            </div>
            <div class="card"><div class="card-title">Yoga</div><div class="card-val" id="p-yoga">--</div></div>
            <div class="card"><div class="card-title">Karan</div><div class="card-val" id="p-karan">--</div></div>
            <div class="card"><div class="card-title">Yamaganda</div><div class="card-val" id="p-yama">--</div></div>
            <div class="card"><div class="card-title">Sun Rise/Set</div><div class="card-val" id="p-sun">--</div></div>
        </div>
    </div>

    <!-- 4. TOOLS TAB -->
    <div id="view-tools" class="view">
        <h1>Pro <span>Tools</span></h1>
        <div class="tabs">
            <div class="tab-pill active" onclick="switchTool('alarm', this)">Alarms</div>
            <div class="tab-pill" onclick="switchTool('stopwatch', this)">Stopwatch</div>
            <div class="tab-pill" onclick="switchTool('timer', this)">Timer</div>
        </div>

        <!-- ALARM UI -->
        <div id="tool-alarm" class="tool-panel active">
            <div style="display: flex; gap: 10px;">
                <input type="time" id="alarm-in" style="padding: 15px; background: var(--surface-2); color: white; border: none; border-radius: 8px; font-size: 1.2rem;">
                <input type="text" id="alarm-lbl" placeholder="Label" style="flex:1; padding: 15px; background: var(--surface-2); color: white; border: none; border-radius: 8px;">
                <button onclick="addAlarm()" style="padding: 0 20px; background: var(--primary); border: none; border-radius: 8px; font-weight: bold;">ADD</button>
            </div>
            <div id="alarm-list" class="alarm-list"></div>
        </div>

        <!-- STOPWATCH UI -->
        <div id="tool-stopwatch" class="tool-panel">
            <div class="big-timer" id="sw-disp">00:00.00</div>
            <div class="btn-group">
                <button class="btn btn-start" onclick="swAction('start')"><span class="material-icons-round">play_arrow</span></button>
                <button class="btn btn-stop" onclick="swAction('stop')"><span class="material-icons-round">pause</span></button>
                <button class="btn btn-reset" onclick="swAction('reset')"><span class="material-icons-round">refresh</span></button>
            </div>
            <div id="sw-laps" style="margin-top: 20px; text-align: center; color: var(--text-dim);"></div>
        </div>

        <!-- TIMER UI -->
        <div id="tool-timer" class="tool-panel">
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="tab-pill" onclick="setTimer(5)">5m</button>
                <button class="tab-pill" onclick="setTimer(25)">25m</button>
                <button class="tab-pill" onclick="setTimer(60)">1h</button>
            </div>
            <div class="big-timer" id="tm-disp">00:00</div>
             <div class="btn-group">
                <button class="btn btn-start" onclick="tmStart()"><span class="material-icons-round">play_arrow</span></button>
                <button class="btn btn-reset" onclick="tmReset()"><span class="material-icons-round">refresh</span></button>
            </div>
        </div>
    </div>

</main>

<script>
    /* --- 1. CONFIG & CITY DATA --- */
    const cities = [
        {n:"New York", z:"America/New_York"}, {n:"London", z:"Europe/London"}, {n:"Paris", z:"Europe/Paris"}, 
        {n:"Dubai", z:"Asia/Dubai"}, {n:"Tokyo", z:"Asia/Tokyo"}, {n:"Sydney", z:"Australia/Sydney"},
        {n:"Mumbai", z:"Asia/Kolkata"}, {n:"Singapore", z:"Asia/Singapore"}, {n:"Los Angeles", z:"America/Los_Angeles"},
        {n:"Chicago", z:"America/Chicago"}, {n:"Toronto", z:"America/Toronto"}, {n:"Berlin", z:"Europe/Berlin"},
        {n:"Moscow", z:"Europe/Moscow"}, {n:"Shanghai", z:"Asia/Shanghai"}, {n:"Seoul", z:"Asia/Seoul"},
        {n:"Bangkok", z:"Asia/Bangkok"}, {n:"Hong Kong", z:"Asia/Hong_Kong"}, {n:"Istanbul", z:"Europe/Istanbul"},
        {n:"Cairo", z:"Africa/Cairo"}, {n:"Johannesburg", z:"Africa/Johannesburg"}, {n:"Lagos", z:"Africa/Lagos"},
        {n:"Rio de Janeiro", z:"America/Sao_Paulo"}, {n:"Mexico City", z:"America/Mexico_City"}, {n:"Vancouver", z:"America/Vancouver"},
        {n:"Riyadh", z:"Asia/Riyadh"}, {n:"Tehran", z:"Asia/Tehran"}, {n:"Rome", z:"Europe/Rome"}, {n:"Zurich", z:"Europe/Zurich"}
    ];
    let alarms = JSON.parse(localStorage.getItem('alarms')) || [];
    let swInt, swTime = 0, tmInt, tmTime = 0;

    /* --- 2. CORE CLOCK --- */
    function tick() {
        const now = new Date();
        
        // Digital
        document.getElementById('digi-time').innerText = now.toLocaleTimeString('en-US', {hour12:false});
        document.getElementById('digi-date').innerText = now.toLocaleDateString('en-US', {weekday:'long', month:'long', day:'numeric'});

        // Analog
        const s = now.getSeconds();
        const m = now.getMinutes();
        const h = now.getHours();
        document.getElementById('s-hand').style.transform = `translateX(-50%) rotate(${s*6}deg)`;
        document.getElementById('m-hand').style.transform = `translateX(-50%) rotate(${m*6 + s*0.1}deg)`;
        document.getElementById('h-hand').style.transform = `translateX(-50%) rotate(${h*30 + m*0.5}deg)`;

        // Alarms Check
        checkAlarms(now);
    }
    setInterval(tick, 1000);

    /* --- 3. WORLD CLOCK --- */
    function filterCities(q) {
        const grid = document.getElementById('city-grid');
        grid.innerHTML = '';
        const now = new Date();
        cities.filter(c => c.n.toLowerCase().includes(q.toLowerCase())).forEach(c => {
             const t = now.toLocaleTimeString('en-US', {timeZone:c.z, hour:'2-digit', minute:'2-digit', hour12:false});
             grid.innerHTML += `<div class="card" style="padding:15px"><div class="card-title">${c.n}</div><div class="card-val" style="color:var(--primary); font-size:1.2rem">${t}</div></div>`;
        });
    }
    filterCities('');

    /* --- 4. VEDIC ENGINE --- */
    function updateVedic() {
        const now = new Date();
        // Using Astronomy Engine for high precision
        const sun = Astronomy.EclipticLongitude('Sun', now);
        const moon = Astronomy.EclipticLongitude('Moon', now);
        const ayanamsa = 24.22; // Lahiri approx
        const sSun = (sun - ayanamsa + 360) % 360;
        const sMoon = (moon - ayanamsa + 360) % 360;

        // Tithi
        const tIdx = Math.ceil(((sMoon - sSun + 360)%360)/12);
        document.getElementById('p-tithi').innerText = ["","Pratipada","Dwitiya","Tritiya","Chaturthi","Panchami","Shashthi","Saptami","Ashtami","Navami","Dashami","Ekadashi","Dwadashi","Trayodashi","Chaturdashi","Purnima/Amavasya"][tIdx > 15 ? tIdx-15 : tIdx] || "Tithi "+tIdx;
        document.getElementById('p-paksha').innerText = tIdx <= 15 ? "Shukla Paksha" : "Krishna Paksha";

        // Nakshatra
        const nIdx = Math.floor(sMoon / 13.333);
        const naks = ["Ashwini","Bharani","Krittika","Rohini","Mrigashirsha","Ardra","Punarvasu","Pushya","Ashlesha","Magha","Purva P.","Uttara P.","Hasta","Chitra","Swati","Vishakha","Anuradha","Jyeshtha","Mula","Purva A.","Uttara A.","Shravana","Dhanishtha","Shatabhisha","Purva B.","Uttara B.","Revati"];
        document.getElementById('p-nak').innerText = naks[nIdx] || "--";

        // Yoga
        const yIdx = Math.floor(((sSun + sMoon)%360) / 13.333);
        document.getElementById('p-yoga').innerText = "Yoga " + (yIdx+1);

        // Karan
        document.getElementById('p-karan').innerText = "Karan " + Math.ceil(((sMoon - sSun + 360)%360)/6);

        // Rahukaal (Approx Rules)
        const d = now.getDay();
        const rahu = ["16:30-18:00","07:30-09:00","15:00-16:30","12:00-13:30","13:30-15:00","10:30-12:00","09:00-10:30"];
        const yama = ["12:00-13:30","10:30-12:00","09:00-10:30","07:30-09:00","06:00-07:30","15:00-16:30","13:30-15:00"];
        document.getElementById('p-rahu').innerText = rahu[d];
        document.getElementById('p-yama').innerText = yama[d];
    }
    updateVedic();

    /* --- 5. ALARMS --- */
    function renderAlarms() {
        const list = document.getElementById('alarm-list');
        list.innerHTML = '';
        alarms.forEach((a,i) => {
            list.innerHTML += `<div class="alarm-item ${a.triggered ? 'ringing' : ''}"><div><div style="font-size:1.2rem; font-weight:bold">${a.time}</div><div style="color:var(--text-dim); font-size:0.8rem">${a.label}</div></div><button onclick="delAlarm(${i})" style="background:none; border:none; color:var(--danger); cursor:pointer"><span class="material-icons-round">delete</span></button></div>`;
        });
        localStorage.setItem('alarms', JSON.stringify(alarms));
    }
    function addAlarm() {
        const t = document.getElementById('alarm-in').value;
        const l = document.getElementById('alarm-lbl').value || 'Alarm';
        if(t) { alarms.push({time:t, label:l, triggered:false}); renderAlarms(); }
    }
    function delAlarm(i) { alarms.splice(i,1); renderAlarms(); }
    function checkAlarms(now) {
        const tStr = now.toTimeString().slice(0,5);
        if(now.getSeconds() !== 0) return;
        alarms.forEach(a => {
            if(a.time === tStr) {
                a.triggered = true;
                alert("â° ALARM: " + a.label);
                renderAlarms();
            }
        });
    }
    renderAlarms();

    /* --- 6. STOPWATCH & TIMER --- */
    function swAction(act) {
        if(act==='start') {
            if(swInt) return;
            const startT = Date.now() - swTime;
            swInt = setInterval(() => {
                swTime = Date.now() - startT;
                let ms = Math.floor((swTime % 1000) / 10);
                let s = Math.floor((swTime / 1000) % 60);
                let m = Math.floor((swTime / 60000) % 60);
                document.getElementById('sw-disp').innerText = `${m<10?'0'+m:m}:${s<10?'0'+s:s}.${ms<10?'0'+ms:ms}`;
            }, 10);
        } else if(act==='stop') {
            clearInterval(swInt); swInt = null;
        } else {
            clearInterval(swInt); swInt = null; swTime = 0;
            document.getElementById('sw-disp').innerText = "00:00.00";
        }
    }

    function setTimer(m) { tmTime = m * 60; updTm(); }
    function tmStart() {
        if(tmInt) return;
        tmInt = setInterval(() => {
            if(tmTime > 0) { tmTime--; updTm(); }
            else { clearInterval(tmInt); tmInt=null; alert("Timer Done!"); }
        }, 1000);
    }
    function tmReset() { clearInterval(tmInt); tmInt=null; tmTime=0; updTm(); }
    function updTm() {
        let m = Math.floor(tmTime / 60);
        let s = tmTime % 60;
        document.getElementById('tm-disp').innerText = `${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
    }

    /* --- UTILS --- */
    function show(id, btn) {
        document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
        document.getElementById('view-'+id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(e=>e.classList.remove('active'));
        btn.classList.add('active');
    }
    function switchTool(id, pill) {
        document.querySelectorAll('.tool-panel').forEach(e=>e.classList.remove('active'));
        document.getElementById('tool-'+id).classList.add('active');
        document.querySelectorAll('.tab-pill').forEach(e=>e.classList.remove('active'));
        pill.classList.add('active');
    }
</script>
</body>
</html>
